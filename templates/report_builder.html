<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Report Profile Builder</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root { font-family: "Inter", system-ui, sans-serif; color: #0f1a33; }
    body { margin: 0; background: #f0f4fb; }
    header { background: #09224d; color: #fff; padding: 1.6rem 2.2rem; display: flex; justify-content: space-between; align-items: center; }
    header h1 { margin: 0; font-size: 1.8rem; }
    header p { margin: 0.4rem 0 0; color: #aab7dd; }
    header a { color: #8ed1ff; text-decoration: none; font-size: 0.95rem; }
    main { padding: 1.6rem; max-width: 1250px; margin: 0 auto; display: grid; grid-template-columns: 330px 1fr; gap: 1.5rem; }
    section { background: #fff; border-radius: 18px; padding: 1.5rem; box-shadow: 0 20px 45px rgba(10,30,70,0.08); }
    h2 { margin: 0 0 0.3rem; font-size: 1rem; letter-spacing: 0.05em; text-transform: uppercase; color: #1b3c8a; }
    label { display: block; font-weight: 600; margin-bottom: 0.25rem; }
    select, input { width: 100%; padding: 0.55rem 0.65rem; border-radius: 8px; border: 1px solid #d1dbee; font-size: 0.95rem; }
    textarea { width: 100%; padding: 0.55rem 0.65rem; border-radius: 8px; border: 1px solid #d1dbee; font-size: 0.95rem; min-height: 80px; }
    button { border: none; border-radius: 999px; padding: 0.55rem 1rem; font-size: 0.95rem; cursor: pointer; }
    button.primary { background: linear-gradient(120deg, #1363f1, #23c4ff); color: #fff; }
    button.light { background: #eef3ff; color: #143a9c; border: 1px solid rgba(20,58,156,0.2); }
    button.ghost { background: transparent; color: #143a9c; border: 1px dashed rgba(20,58,156,0.4); }
    table { width: 100%; border-collapse: collapse; margin-top: 0.6rem; }
    th, td { text-align: left; padding: 0.55rem; border-bottom: 1px solid #e9eef9; font-size: 0.9rem; vertical-align: top; }
    th { background: #f6f8ff; text-transform: uppercase; letter-spacing: 0.05em; font-size: 0.8rem; color: #4d5a7d; }
    .status { min-height: 1rem; font-size: 0.9rem; color: #1a52ce; margin-top: 0.6rem; }
    .grid-full { grid-column: 1 / -1; }
    .panel { display: flex; flex-direction: column; gap: 0.7rem; }
    .metric-list { background: #f7f9ff; border-radius: 12px; padding: 0.8rem; font-size: 0.9rem; color: #4d5a7d; max-height: 200px; overflow: auto; }
    .toolbar { display: flex; gap: 0.6rem; flex-wrap: wrap; margin-top: 0.5rem; }
    .preview-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 1rem; }
    .preview-box { background: #040c1c; color: #e3e9ff; padding: 1rem; border-radius: 12px; max-height: 60vh; overflow: auto; }
    .hint { font-size: 0.85rem; color: #5a6b8c; margin: 0; }
    .row-actions button { background: none; border: none; color: #a82138; cursor: pointer; font-size: 0.85rem; padding: 0; }
    .row-actions button:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <header>
    <div>
      <h1>Report Profile Builder</h1>
      <p>Design the shared summary & detail layout used by every deal.</p>
    </div>
    <a href="/">← Back to Config Builder</a>
  </header>

  <main>
    <section class="panel">
      <div>
        <h2>1 · Source Config</h2>
        <p class="hint">Pick a config to see which metrics you can drop into the report.</p>
      </div>
      <label for="config-select">Use metrics from</label>
      <select id="config-select"></select>
      <div class="toolbar">
        <button id="reload-configs" class="light">Reload</button>
        <button id="load-metrics" class="primary">Load Metrics</button>
      </div>
      <div class="status" id="config-status"></div>
      <h3>Available Metrics</h3>
      <div id="metric-list" class="metric-list">Select a config to list its metrics.</div>
    </section>

    <section class="panel grid-full">
      <h2>2 · Shared Summary</h2>
      <p class="hint">These fields appear at the top of every Outlook draft.</p>
      <table id="summary-table">
        <thead>
          <tr>
            <th>Label</th>
            <th>Source</th>
            <th>Format</th>
            <th>Aggregate</th>
            <th></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <button id="add-summary-field" class="light">+ Add Summary Field</button>
    </section>

    <section class="panel grid-full">
      <h2>3 · Detail Quadrants</h2>
      <p class="hint">Each row renders four columns (label/value, label/value). Names sit in column 1 & 3; values in 2 & 4.</p>
      <table id="detail-table" class="detail-table">
        <thead>
          <tr>
            <th>Left Label</th>
            <th>Left Value</th>
            <th>Right Label</th>
            <th>Right Value</th>
            <th></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <button id="add-detail-row" class="light">+ Add Detail Row</button>
    </section>

    <section class="panel grid-full">
      <h2>4 · Save & Preview</h2>
      <div class="toolbar">
        <button id="save-profile" class="primary">Save Profile</button>
        <button id="reset-profile" class="light">Reset</button>
        <button id="visualize-report" class="ghost">Visualize Email</button>
      </div>
      <div class="status" id="profile-status"></div>
      <div class="preview-grid">
        <div>
          <h3>Profile JSON</h3>
          <pre id="profile-preview" class="preview-box">Loading…</pre>
        </div>
        <div>
          <h3>Tips</h3>
          <ul class="hint" style="list-style: disc; padding-left: 1.2rem;">
            <li><strong>Label</strong> controls what bankers see.</li>
            <li><strong>Source</strong> is any metric from the selected config.</li>
            <li>Switch to “Text” to add a note or placeholder.</li>
          </ul>
        </div>
      </div>
    </section>
  </main>

  <script src="/static/report_builder.js"></script>
</body>
</html>
